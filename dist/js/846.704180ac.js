"use strict";(self["webpackChunkvue_final"]=self["webpackChunkvue_final"]||[]).push([[846],{9827:function(e,o,t){var a=t(1076),n=t(1020);o.Z=(0,n.Q_)("couponStore",{state:()=>({coupons:[],pagination:{}}),getters:{couponsList:e=>e.coupons},actions:{getCoupons(e=1){return new Promise((async(o,t)=>{const n=`https://vue3-course-api.hexschool.io/api/chaichai_api/admin/coupons/?page=${e}`;try{const e=await a.Z.get(n);console.log(e),this.coupons=e.data.coupons,this.pagination=e.data.pagination,o()}catch(l){console.log(l),t()}}))}}})},8464:function(e,o,t){t.d(o,{Z:function(){return f}});var a=t(3396),n=t(9242),l=t(7139);const s={"aria-label":"Page navigation example"},i={class:"pagination justify-content-center"},p={key:0,class:"page-item"},d=(0,a._)("span",{"aria-hidden":"true"},"«",-1),u=[d],c=["onClick"],r={key:1,class:"page-item"},h=(0,a._)("span",{"aria-hidden":"true"},"»",-1),m=[h];function _(e,o,t,d,h,_){return(0,a.wg)(),(0,a.iD)("nav",s,[(0,a._)("ul",i,[1!==t.pages.current_page?((0,a.wg)(),(0,a.iD)("li",p,[(0,a._)("a",{class:"page-link",href:"#",onClick:o[0]||(o[0]=(0,n.iM)((e=>_.updatePage(t.pages.current_page-1)),["prevent"])),"aria-label":"Previous"},u)])):(0,a.kq)("",!0),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.pages.total_pages,(e=>((0,a.wg)(),(0,a.iD)("li",{class:(0,l.C_)(["page-item",{active:e===t.pages.current_page}]),key:e},[(0,a._)("a",{class:"page-link",href:"#",onClick:(0,n.iM)((o=>_.updatePage(e)),["prevent"])},(0,l.zw)(e),9,c)],2)))),128)),t.pages.current_page!==t.pages.total_pages?((0,a.wg)(),(0,a.iD)("li",r,[(0,a._)("a",{class:"page-link",href:"#",onClick:o[1]||(o[1]=(0,n.iM)((e=>_.updatePage(t.pages.current_page+1)),["prevent"])),"aria-label":"Next"},m)])):(0,a.kq)("",!0)])])}var g={props:["pages"],methods:{updatePage(e){console.log(e),this.$emit("emit-pages",e)}}},b=t(89);const C=(0,b.Z)(g,[["render",_]]);var f=C},4846:function(e,o,t){t.r(o),t.d(o,{default:function(){return J}});var a=t(3396),n=t(7139);const l={class:"container"},s={class:"row mt-5"},i={class:"text-end mt-5"},p={class:"table mt-5 text-center table-radius"},d=(0,a._)("thead",{class:"table-theme"},[(0,a._)("tr",null,[(0,a._)("th",null,"名稱"),(0,a._)("th",null,"折扣百分比"),(0,a._)("th",null,"到期日"),(0,a._)("th",{width:"120"},"是否啟用"),(0,a._)("th",null,"編輯")])],-1),u={key:0,class:"is-enabled-border is-enabled"},c={key:1,class:"is-enabled-border not-enabled"},r={class:"btn-group"},h=["onClick"],m=(0,a._)("i",{class:"bi bi-pencil-square"},null,-1),_=[m],g=["onClick"],b=(0,a._)("i",{class:"bi bi-trash3"},null,-1),C=[b];function f(e,o,t,m,b,f){const v=(0,a.up)("Loading"),w=(0,a.up)("couponModal"),M=(0,a.up)("DelModal"),k=(0,a.up)("Pagination");return(0,a.wg)(),(0,a.iD)("div",l,[(0,a._)("div",s,[(0,a.Wm)(v,{active:b.isLoading},null,8,["active"]),(0,a._)("div",i,[(0,a._)("button",{class:"new-product",onClick:o[0]||(o[0]=e=>f.openCouponModal(!0))}," 建立優惠券 ")]),(0,a._)("table",p,[d,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.coupons,((o,t)=>((0,a.wg)(),(0,a.iD)("tr",{key:t},[(0,a._)("td",null,(0,n.zw)(o.title),1),(0,a._)("td",null,(0,n.zw)(o.percent)+"%",1),(0,a._)("td",null,(0,n.zw)(e.$filters.date(o.due_date)),1),(0,a._)("td",null,[1===o.is_enabled?((0,a.wg)(),(0,a.iD)("span",u,"啟用")):((0,a.wg)(),(0,a.iD)("span",c,"未啟用"))]),(0,a._)("td",null,[(0,a._)("div",r,[(0,a._)("button",{class:"btn btn-primary",onClick:e=>f.openCouponModal(!1,o)},_,8,h),(0,a._)("button",{class:"btn btn-danger",onClick:e=>f.openDelCouponModal(o)},C,8,g)])])])))),128))])]),(0,a.Wm)(w,{coupon:b.tempCoupon,ref:"couponModal",onUpdateCoupon:f.updateCoupon},null,8,["coupon","onUpdateCoupon"]),(0,a.Wm)(M,{item:b.tempCoupon,ref:"delModal",onDelItem:f.delCoupon},null,8,["item","onDelItem"]),(0,a.Wm)(k,{pages:e.pagination,onEmitPages:e.getCoupons},null,8,["pages","onEmitPages"])])])}var v=t(1020),w=t(9827),M=t(9242);const k={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},y={class:"modal-dialog",role:"document"},D={class:"modal-content"},$=(0,a._)("div",{class:"modal-header bg-modal-brown text-white"},[(0,a._)("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠券"),(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),x={class:"modal-body"},P={class:"mb-3"},Z=(0,a._)("label",{for:"title"},"標題",-1),L={class:"mb-3"},U=(0,a._)("label",{for:"coupon_code"},"優惠碼",-1),S={class:"mb-3"},N=(0,a._)("label",{for:"due_date"},"到期日",-1),V={class:"mb-3"},z=(0,a._)("label",{for:"price"},"折扣百分比",-1),W={class:"mb-3"},q={class:"form-check"},I=(0,a._)("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),j={class:"modal-footer"},E=(0,a._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function H(e,o,t,n,l,s){return(0,a.wg)(),(0,a.iD)("div",k,[(0,a._)("div",y,[(0,a._)("div",D,[$,(0,a._)("div",x,[(0,a._)("div",P,[Z,(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":o[0]||(o[0]=e=>l.tempCoupon.title=e),placeholder:"請輸入標題"},null,512),[[M.nr,l.tempCoupon.title]])]),(0,a._)("div",L,[U,(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":o[1]||(o[1]=e=>l.tempCoupon.code=e),placeholder:"請輸入優惠碼"},null,512),[[M.nr,l.tempCoupon.code]])]),(0,a._)("div",S,[N,(0,a.wy)((0,a._)("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=e=>l.due_date=e)},null,512),[[M.nr,l.due_date]])]),(0,a._)("div",V,[z,(0,a.wy)((0,a._)("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":o[3]||(o[3]=e=>l.tempCoupon.percent=e),placeholder:"請輸入折扣百分比"},null,512),[[M.nr,l.tempCoupon.percent,void 0,{number:!0}]])]),(0,a._)("div",W,[(0,a._)("div",q,[(0,a.wy)((0,a._)("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=e=>l.tempCoupon.is_enabled=e),id:"is_enabled"},null,512),[[M.e8,l.tempCoupon.is_enabled]]),I])])]),(0,a._)("div",j,[E,(0,a._)("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=o=>e.$emit("update-coupon",l.tempCoupon))},"更新優惠券 ")])])])],512)}var K=t(1339),O={name:"couponModal",props:{coupon:{}},data(){return{tempCoupon:{},due_date:""}},emits:["update-coupon"],watch:{coupon(){this.tempCoupon=this.coupon,console.log(this.tempCoupon.due_date);const e=new Date(1e3*this.tempCoupon.due_date).toISOString().split("T");[this.due_date]=e,"undefined"===typeof this.tempCoupon.is_enabled&&(this.tempCoupon.is_enabled=0)},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mixins:[K.Z]},T=t(89);const Y=(0,T.Z)(O,[["render",H]]);var Q=Y,A=t(5919),B=t(8464),F={components:{CouponModal:Q,DelModal:A.Z,Pagination:B.Z},props:{config:Object},data(){return{tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isLoading:!1,isNew:!1}},computed:{...(0,v.rn)(w.Z,["coupons","pagination"])},methods:{...(0,v.nv)(w.Z,["getCoupons"]),openCouponModal(e,o){this.isNew=e,this.isNew?this.tempCoupon={due_date:(new Date).getTime()/1e3}:this.tempCoupon={...o},this.$refs.couponModal.showModal()},openDelCouponModal(e){this.tempCoupon={...e};const o=this.$refs.delModal;o.showModal()},updateCoupon(e){if(this.isNew){const o="https://vue3-course-api.hexschool.io/api/chaichai_api/admin/coupon";this.$http.post(o,{data:e}).then((o=>{console.log(o,e),this.$httpMessageState(o,"新增優惠券"),this.getCoupons(),this.$refs.couponModal.hideModal()}))}else{const e=`https://vue3-course-api.hexschool.io/api/chaichai_api/admin/coupon/${this.tempCoupon.id}`;this.$http.put(e,{data:this.tempCoupon}).then((e=>{console.log(e),this.$httpMessageState(e,"新增優惠券"),this.getCoupons(),this.$refs.couponModal.hideModal()}))}},delCoupon(){const e=`https://vue3-course-api.hexschool.io/api/chaichai_api/admin/coupon/${this.tempCoupon.id}`;this.isLoading=!0,this.$http.delete(e).then((e=>{console.log(e,this.tempCoupon),this.$httpMessageState(e,"刪除優惠券");const o=this.$refs.delModal;o.hideModal(),this.getCoupons()}))}},created(){this.getCoupons()}};const G=(0,T.Z)(F,[["render",f]]);var J=G}}]);
//# sourceMappingURL=846.704180ac.js.map